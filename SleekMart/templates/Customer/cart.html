{% load static %}
{% block content %}

<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">

    <title>SleekMart - Product Detail Page</title>


    <!-- Additional CSS Files -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">

    <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.css' %}">

    <link rel="stylesheet" href="{% static 'css/templatemo-hexashop.css' %}">

    <link rel="stylesheet" href="{% static 'css/owl-carousel.css' %}">

    <link rel="stylesheet" href="{% static 'css/lightbox.css' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/popper.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <style>
        .quantity-input {
            width: 90px; /* Adjust the width as needed */
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
          }
          
          /* Style the update button */
          .update-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
           
          }
          
          .update-button:hover {
            background-color: #45a049;
          }
          .table {
            width: 100%;
            border-collapse: collapse;
            border-spacing: 0;
          }
          
          .table th,
          .table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
          }
          
          .table th {
            background-color: #f2f2f2;
          }
          
          .table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
          }
          
          .table tbody tr:hover {
            background-color: #ddd;
          }
          
          /* Style the buttons */
          .table button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
          }
          
          .table button:hover {
            background-color: #45a049;
          }
        .page-heading {
            margin-top: 80px;
            margin-bottom: 30px;
            background-image: url('{{ category.image.url }}');
            background-position: center center;
            background-size: cover;
            background-repeat: no-repeat;
            
           
        }
        .header-area.header-sticky {
            min-height: 80px;
            background-color: #34a3b4;
          }
          #product .right-content ul.stars {
            position: relative;
            right: -210px;
            top: -45px;
          }
        /* Define styles for the products heading container */
        .products-heading {
            background-color: #34a3b4;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
        }
        
        /* Define styles for the section title */
        .section-title {
            color: #333;
            font-size: 30px;
            margin: 0;
            text-transform: uppercase;
            background-color: #fff;
            border: 2px solid #007bff;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.2);
            animation: floatAnimation 3s ease-in-out infinite, colorChange 4s alternate infinite; /* Apply both animations */
        }
        
        /* Keyframes for the floating animation */
        @keyframes floatAnimation {
            0% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px); /* Adjust the vertical float distance */
            }
            100% {
                transform: translateY(0);
            }
        }
        
        /* Keyframes for changing text color */
        @keyframes colorChange {
            0% {
                color: #007bff; /* Initial color */
            }
            100% {
                color: #ff0000; /* New color (you can adjust this) */
            }
        }
        /* CSS to style the disabled row */
.disabled-row {
    opacity: 0.5; /* Adjust opacity to visually indicate the row is disabled */
    pointer-events: none; /* Disable pointer events on the row */
}

    
    </style>
</head>

<body>


<header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="{% url 'dashboard_home' %}" class="logo">
                        <h5 style="color:black;position:absolute;top:35px;">Sleek Mart </h5>
                    </a>
                    <!-- ***** Logo End ***** -->
                    <!-- ***** Menu Start ***** -->
                    <ul class="nav">
                        <li class="scroll-to-section"><a href="{% url 'dashboard_home' %}" class="active">Home</a></li>
                        {% for category in categories %}
                        <li class="scroll-to-section"><a href="{% url 'products' category.id %}">{{ category.name }}</a></li>
                        {% comment %} <li class="scroll-to-section"><a href="{% url 'dashboard_home' %}">Women's</a></li>
                        <li class="scroll-to-section"><a href="{% url 'dashboard_home' %}">Kid's</a></li> {% endcomment %}
                        {% endfor %}
                        {% comment %} <li class="submenu">
                            <a href="javascript:;">Pages</a>
                            <ul>
                                <li><a href="about">About Us</a></li>
                                <li><a href="products">Products</a></li>
                                <li><a href="single-product">Single Product</a></li>
                                <li><a href="contact">Contact Us</a></li>
                            </ul>
                        </li>
                        <li class="submenu">
                            <a href="javascript:;">Features</a>
                            <ul>
                                <li><a href="#">Features Page 1</a></li>
                                <li><a href="#">Features Page 2</a></li>
                                <li><a href="#">Features Page 3</a></li>
                                <li><a rel="nofollow" href="https://templatemo.com/page/4" target="_blank">Template Page 4</a></li>
                            </ul>
                        </li> {% endcomment %}
                        <li class="scroll-to-section">
                          <a href="{% url 'cart_details' %}">Cart <span class="cart-count" style="color:red;">({{ cart_count }})</span></a>
                      </li>
                        <li class="scroll-to-section">
                            <a href="{% url 'view_wishlist' %}"> Wishlist <span class="wishlist-count" style="color:red;">({{ wishlist_count }})</span></a>
                        </li>
                        {% if user.is_authenticated %}
                        <li class="scroll-to-section"><a href="{% url 'loggout' %}">Logout</a></li>
                        {% else %}
                        <li class="scroll-to-section"><a href="{% url 'loggout' %}">SignIn/Signup</a></li>
                        {% endif %}
                    </ul>        
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                    <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
</header>
    <div class="container" style="position:relative;top:25px;">
        <h1>Your Shopping Cart</h1>
        <br><br>
        {% if cart_empty %}
                <h6>Your cart is empty.</h6>
                <div class="alert alert-info">
                    Your Cart is empty. <a href="{% url 'dashboard_home' %}" class="alert-link">Start shopping now</a>!
                  </div>
                {% else %}
        <table class="table">
            <thead>
                <tr>
                    {% comment %} <th>Image</th> {% endcomment %}
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                
                {% for cart_item in cart_items %}
                    <tr {% if cart_item.product.quantity == 0 %}class="disabled-row"{% endif %}>
                        {% comment %} <td><img src="{{ cart_item.product.product_image.url }}" alt="{{ product.name }}" style="max-width: 200px;"></td> {% endcomment %}
                        <td><a href="{% url 'each_product' cart_item.product.id %}">{{ cart_item.product.name }}
                            {% if cart_item.product.quantity == 0 %}
                                    (Out of Stock)
                            {% endif %}
                        </a></td>
                       
                        <td>
                             {% comment %} <form method="post" action="{% url 'update_cart_item' cart_item.id %}">
                                {% csrf_token %}
                                <input type="number" name="quantity" value="{{ cart_item.quantity }}" id="quantityInput" class="quantity-input" min="1" max="{{ cart_item.product.quantity }}">
                                <button type="submit" class="update-button">Update</button>
                            </form>   {% endcomment %}
                            {% comment %} <input type="number" name="quantity" value="{{ cart_item.quantity }}" class="quantity-input" data-cart-item-id="{{ cart_item.id }}"> {% endcomment %}
                            <div class="quantity buttons_added">
                                <input type="button" value="-" class="minus quantity-button" data-field="quantityInput{{ cart_item.id }}" onclick="updateQuantity('{{ cart_item.id }}', {{ cart_item.product.selling_price }}, -1)">
                                <input type="number" min="1" max="{{ cart_item.product.quantity }}" name="quantity{{ cart_item.id }}" value="{{ cart_item.quantity }}" id="quantityInput{{ cart_item.id }}" title="Qty" class="input-text qty text quantity-input" size="4" pattern="" inputmode="" oninput="validateQuantity(this)">
                                <input type="button" value="+" class="plus quantity-button" data-field="quantityInput{{ cart_item.id }}" onclick="updateQuantity('{{ cart_item.id }}', {{ cart_item.product.selling_price }}, 1)">
                            </div>
                            
                            
                            
                        </td>
                        <td>${{ cart_item.product.selling_price }}</td>
                        <td class="total-price"><span id="totalPrice{{ cart_item.id }}">${{ cart_item.total_price }}</span></td>
                        <td>
                            <form method="post" action="{% url 'remove_cart_item' cart_item.id %}">
                                {% csrf_token %}
                                <button type="submit" class="update-button">Remove</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                
            </tbody>
        </table>
        {% endif %}
        <br><br>
        {% if cart_empty is False %}
        <div>
            <b>Total: <span id="total_price">{{ total_price }}</span></b>


            <br>
            <a href="{% url 'checkout' %}" class="btn btn-primary">Proceed to Checkout</a>
           
        </div>
        {% endif %}
    </div>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="first-item">
                        <div class="logo">
                            <img src="{% static 'images/white-logo.png' %}" alt="hexashop ecommerce templatemo">
                        </div>
                        <ul>
                            <li><a href="#">16501 SleekMart, Kochi, FL 33160, Kerala</a></li>
                            <li><a href="#">sleekmart@company.com</a></li>
                            <li><a href="#">010-020-0340</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3">
                    <h4>Shopping &amp; Categories</h4>
                    <ul>
                        <li><a href="#">Men’s Shopping</a></li>
                        <li><a href="#">Women’s Shopping</a></li>
                        <li><a href="#">Kid's Shopping</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <h4>Useful Links</h4>
                    <ul>
                        <li><a href="#">Homepage</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Help</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-lg-3">
                    <h4>Help &amp; Information</h4>
                    <ul>
                        <li><a href="#">Help</a></li>
                        <li><a href="#">FAQ's</a></li>
                        <li><a href="#">Shipping</a></li>
                        <li><a href="#">Tracking ID</a></li>
                    </ul>
                </div>
                <div class="col-lg-12">
                    <div class="under-footer">
                        <p>Copyright © 2022 sleekmart Co., Ltd. All Rights Reserved. 
                        
                        {% comment %} <br>Design: <a href="https://templatemo.com" target="_parent" title="free css templates">TemplateMo</a></p> {% endcomment %}
                        <ul>
                            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="#"><i class="fa fa-linkedin"></i></a></li>
                            <li><a href="#"><i class="fa fa-behance"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Plugins -->
    <script src="{% static 'js/owl-carousel.js' %}"></script>
    <script src="{% static 'js/accordions.js' %}"></script>
    <script src="{% static 'js/datepicker.js' %}"></script>
    <script src="{% static 'js/scrollreveal.min.js' %}"></script>
    <script src="{% static 'js/waypoints.min.js' %}"></script>
    <script src="{% static 'js/jquery.counterup.min.js' %}"></script>
    <script src="{% static 'js/imgfix.min.js' %}"></script> 
    <script src="{% static 'js/slick.js' %}"></script> 
    <script src="{% static 'js/lightbox.js' %}"></script> 
    <script src="{% static 'js/isotope.js' %}"></script> 
    <script src="{% static 'js/quantity.js' %}"></script>
   
    <!-- Global Init -->
    <script src="{% static 'js/custom.js' %}"></script>
   
    <script>

        $(function() {
            var selectedClass = "";
            $("p").click(function(){
            selectedClass = $(this).attr("data-rel");
            $("#portfolio").fadeTo(50, 0.1);
                $("#portfolio div").not("."+selectedClass).fadeOut();
            setTimeout(function() {
              $("."+selectedClass).fadeIn();
              $("#portfolio").fadeTo(50, 1);
            }, 500);
                
            });
        });
        function updateQuantity(itemId, itemPrice, change) {
            console.log('Updating quantity for item:', itemId);
        
            var quantityElement = document.getElementById('quantityInput' + itemId);
            var maxQuantity = parseInt(quantityElement.max, 10);
            var currentQuantity = parseInt(quantityElement.value, 10);
            
            console.log('itemPrice:', itemPrice);
            console.log('currentQuantity:', currentQuantity);
            console.log('change:', change);
            // Calculate the new quantity
            var newQuantity = currentQuantity + change;
            console.log('newQuantity:', newQuantity);
            newQuantity = Math.max(newQuantity, 1);
            newQuantity = Math.min(newQuantity, maxQuantity);
        
            // Update the displayed quantity and total price
            quantityElement.value = newQuantity;
        
            var priceElement = document.getElementById('totalPrice' + itemId);
            console.log('itemPrice:', itemPrice);
            var itemTotalPrice = newQuantity * parseFloat(itemPrice);
        
            priceElement.innerText = '$' + itemTotalPrice.toFixed(2);
        
            // Get the CSRF token
            var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
        
            // Update the CSRF token in the AJAX headers
            $.ajaxSetup({
                headers: {
                    'X-CSRFToken': csrfToken
                }
            });
        
            // Send the AJAX request to update the quantity
            $.ajax({
                type: "POST",
                url: "/update_cart_item/" + itemId + "/",  // Update with your actual URL
                data: {
                    quantity: newQuantity
                },
                success: function(data) {
                    // Handle success if needed
                    console.log('Cart item quantity updated successfully.');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("AJAX request failed: " + textStatus, errorThrown);
                }
            });
        
            // Recalculate and update the overall total price
            var overallTotalPrice = 0;
        
            // Iterate through all cart items to calculate the sum of total prices
            {% for cart_item in cart_items %}
                var itemTotalPrice = parseFloat(document.getElementById('totalPrice{{ cart_item.id }}').innerText.replace('$', ''));
                overallTotalPrice += itemTotalPrice;
            {% endfor %}
        
            // Update the overall total price in the HTML
            var total_priceElement = document.getElementById('total_price');
            total_priceElement.innerText = '$' + overallTotalPrice.toFixed(2);
        }
        
        
        function validateQuantity(input) {
            var value = parseInt(input.value, 10);
            var max = parseInt(input.max, 10);
        
            if (isNaN(value) || value < 1) {
                input.value = 1;
            } else if (!isNaN(max) && value > max) {
                input.value = max;
            }
        }
        
        
        
        
         {% comment %} $('[id^="quantityInput_"]').on('input', function () {
            updateTotalPrice($(this));
        });
        
        // Add event listeners for the plus and minus buttons
        $('.plus').on('click', function () {
            console.log('entered')
            var input = $(this).siblings('input[name="quantity"]');
            console.log(input.val())
            var currentVal = parseInt(input.val(), 10);
            input.val(currentVal + 1);
            console.log(currentVal)
            updateTotalPrice(input);
        });

        $('.minus').on('click', function () {
            var input = $(this).siblings('input[name="quantity"]');
            var currentVal = parseInt(input.val(), 10);
            if (currentVal > 1) {
                input.val(currentVal - 1);
                updateTotalPrice(input);
            }
        });
     
        function updateTotalPrice(input) {
            var quantity = parseInt(input.val(), 10);
            var productId = input.attr('id').split('_')[1];
            var sellingPrice = parseFloat($('#totalPrice_' + productId).data('selling-price'));
            var newTotalPrice = sellingPrice * quantity;
            $('#totalPrice_' + productId).text('$' + newTotalPrice.toFixed(2));
        } 
        
        document.addEventListener('DOMContentLoaded', function () {
            console.log('entered')
            var quantityInput = document.getElementById('quantityInput');
            var maxQuantity = {{ cart_item.product.quantity }}; // Get the available product quantity
            
            quantityInput.addEventListener('input', function () {
                var enteredQuantity = parseInt(quantityInput.value, 10);
        
                // Check if the entered quantity is greater than the available quantity
                if (enteredQuantity > maxQuantity) {
                    quantityInput.value = maxQuantity; // Reset the input value to the maximum
                }
            });
        }); {% endcomment %}
    {% comment %} $(document).ready(function () {
        $('.quantity-input').on('input', function () {
            var cartItemId = $(this).data('cart-item-id');
            var newQuantity = parseInt($(this).val(), 10);

            // Make an AJAX request to update the quantity
            $.ajax({
                url: '{% url 'update_cart_item' 0 %}'.replace('0', cartItemId),
                type: 'POST',
                data: {
                    'quantity': newQuantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function (data) {
                    // Update the total price in the table
                    var totalPriceCell = $('td.total-price[data-cart-item-id="' + cartItemId + '"]');
                    totalPriceCell.text('$' + data.total_price);
                }
            });
        });
    }); {% endcomment %}
    $(document).ready(function () {
        $.ajaxSetup({ cache: false });
            
        window.onpageshow = function(event) {
            // Check if the page is loaded from the cache
            if (event.persisted) {
                // Page is loaded from cache (back button was used)
                window.location.reload(); // Refresh the page
            }
        };
    });
    </script>
{% endblock %}
</body>

</html>

